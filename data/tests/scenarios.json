{
  "scenarios": [
    {
      "name": "Young Professional - Dining Focus",
      "description": "Recent graduate with high dining expenses, low income",
      "user_profile": {
        "spending": {
          "groceries": 300,
          "dining": 800,
          "gas": 100,
          "general": 400
        },
        "preferences": {
          "max_annual_fee": 100,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": [],
      "available_cards": ["SavorOne Cash Rewards Credit Card", "Quicksilver Cash Rewards Credit Card", "Freedom Unlimited", "Blue Cash Preferred® Card"],
      "expected_recommendations": {
        "actions": ["apply"],
        "min_total_value": 300,
        "must_include_cards": ["SavorOne Cash Rewards Credit Card"],
        "reasoning_must_contain": ["dining"]
      }
    },
    {
      "name": "Business Traveler",
      "description": "High travel and dining expenses, values points for travel",
      "user_profile": {
        "spending": {
          "travel": 1500,
          "dining": 600,
          "groceries": 200,
          "gas": 200,
          "general": 800
        },
        "preferences": {
          "max_annual_fee": 550,
          "preferred_reward_type": "points"
        }
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Reserve®", "The Platinum Card®", "Chase Sapphire Preferred® Card", "Gold Card"],
      "expected_recommendations": {
        "actions": ["apply"],
        "min_total_value": 800,
        "must_include_cards": ["Chase Sapphire Reserve®"],
        "reasoning_must_contain": ["travel"]
      }
    },
    {
      "name": "Family with High Grocery Spend",
      "description": "Large family with substantial grocery and gas expenses",
      "user_profile": {
        "spending": {
          "groceries": 1200,
          "gas": 400,
          "dining": 300,
          "general": 600
        }
      },
      "owned_cards": [],
      "available_cards": ["Blue Cash Preferred® Card", "Costco Anywhere Visa® Card", "Gold Card", "Grocery Specialist"],
      "expected_recommendations": {
        "actions": ["apply"],
        "min_total_value": 500,
        "must_include_cards": ["Blue Cash Preferred® Card"],
        "reasoning_must_contain": ["groceries"]
      }
    },
    {
      "name": "Existing High-Fee Card Review",
      "description": "User with expensive card that may not be worth keeping",
      "user_profile": {
        "spending": {
          "groceries": 200,
          "dining": 150,
          "travel": 100,
          "general": 300
        }
      },
      "owned_cards": ["Expensive Premium Card"],
      "available_cards": ["Expensive Premium Card", "No Fee Alternative", "Freedom Unlimited", "Quicksilver Cash Rewards Credit Card"],
      "expected_recommendations": {
        "actions": ["cancel", "apply"],
        "min_total_value": 50,
        "must_include_cards": ["No Fee Alternative"],
        "reasoning_must_contain": ["cancel"]
      }
    },
    {
      "name": "Multiple Cards Optimization",
      "description": "User with several cards, needs optimization strategy",
      "user_profile": {
        "spending": {
          "groceries": 500,
          "dining": 400,
          "travel": 600,
          "gas": 200,
          "general": 700
        }
      },
      "owned_cards": ["Basic Card", "Travel Card"],
      "available_cards": ["Basic Card", "Travel Card", "Grocery Specialist", "Chase Sapphire Preferred® Card", "Gold Card"],
      "expected_recommendations": {
        "actions": ["keep", "apply"],
        "min_total_value": 300,
        "must_include_cards": ["Grocery Specialist"],
        "reasoning_must_contain": ["keep"]
      }
    },
    {
      "name": "High Grocery Spender",
      "description": "Someone who spends heavily on groceries",
      "user_profile": {
        "spending": {
          "groceries": 1000,
          "dining": 200,
          "gas": 150,
          "general": 500
        }
      },
      "owned_cards": [],
      "available_cards": ["Blue Cash Preferred® Card", "Freedom Unlimited", "Grocery Specialist"],
      "expected_recommendations": {
        "actions": ["apply"],
        "min_total_value": 400,
        "must_include_cards": ["Blue Cash Preferred® Card"]
      }
    },
    {
      "name": "Travel Enthusiast",
      "description": "High travel and dining spending, values points",
      "user_profile": {
        "spending": {
          "travel": 800,
          "dining": 400,
          "groceries": 300,
          "general": 700
        }
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Preferred® Card", "Venture Rewards Credit Card", "Chase Sapphire Reserve®"],
      "expected_recommendations": {
        "actions": ["apply"],
        "min_total_value": 600,
        "must_include_cards": ["Chase Sapphire Preferred® Card"]
      }
    },
    {
      "name": "Existing Card Optimization",
      "description": "User with low-value card that should be optimized",
      "user_profile": {
        "spending": {
          "groceries": 200,
          "dining": 150,
          "gas": 100,
          "general": 300
        }
      },
      "owned_cards": ["Low Value Card"],
      "available_cards": ["Low Value Card", "Better Card"],
      "expected_recommendations": {
        "actions": ["cancel", "apply"],
        "min_total_value": 50,
        "must_include_cards": ["Better Card"]
      }
    },
    {
      "name": "Zero Annual Fee Filter with Signup Bonus",
      "description": "Tests filtering by $0 annual fee and signup bonus inclusion in estimated value",
      "user_profile": {
        "spending": {
          "dining": 100,
          "general": 200
        },
        "preferences": {
          "max_annual_fee": 0,
          "preferred_reward_type": "cashback",
          "card_type": "personal"
        }
      },
      "owned_cards": [],
      "filters": [
        {
          "name": "Card Type Filter",
          "filter_type": "card_type", 
          "value": "personal"
        },
        {
          "name": "Reward Type Filter",
          "filter_type": "reward_type",
          "value": "Cashback"
        },
        {
          "name": "Annual Fee Filter",
          "filter_type": "annual_fee",
          "value": "0-0"
        }
      ],
      "available_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card", "Discover it Cash Back"],
      "expected_recommendations": {
        "actions": ["apply"],
        "min_cards": 1,
        "estimated_value_includes_signup_bonus": true,
        "reasoning_must_contain": ["signup bonus"],
        "test_conditions": [
          "All recommended cards have $0 annual fee",
          "Estimated value includes signup bonus amount",
          "Cards with Decimal annual_fee=0.00 are properly filtered",
          "Break-even cards (annual_value >= 0) are included"
        ]
      }
    },
    {
      "name": "Minimal Spending with Zero Fee Cards",
      "description": "Tests edge case of very low spending with $0 annual fee cards",
      "user_profile": {
        "spending": {
          "general": 50
        }
      },
      "owned_cards": [],
      "filters": [
        {
          "name": "Annual Fee Filter", 
          "filter_type": "annual_fee",
          "value": "0"
        }
      ],
      "available_cards": ["Freedom Unlimited", "Quicksilver Cash Rewards Credit Card", "Blue Cash Everyday"],
      "expected_recommendations": {
        "actions": ["apply"],
        "min_cards": 1,
        "reasoning_must_contain": ["signup bonus"],
        "test_conditions": [
          "Cards are recommended even with minimal spending",
          "Signup bonus provides positive estimated value",
          "Annual value calculation handles low rewards correctly"
        ]
      }
    },
    {
      "name": "Satisfied Card Holder - No New Cards Needed",
      "description": "User with existing cards who doesn't spend enough to justify new cards or annual fees",
      "user_profile": {
        "spending": {
          "groceries": 250,
          "dining": 200,
          "gas": 120,
          "general": 300
        },
        "preferences": {
          "max_annual_fee": 50,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Blue Cash Everyday", "Freedom Unlimited"],
      "available_cards": ["Blue Cash Everyday", "Freedom Unlimited", "Blue Cash Preferred® Card", "SavorOne Cash Rewards Credit Card", "Chase Sapphire Preferred® Card"],
      "expected_recommendations": {
        "actions": ["keep"],
        "min_total_value": 0,
        "max_cards": 0,
        "reasoning_must_contain": ["already have", "low spending", "not worth"],
        "test_conditions": [
          "No new cards recommended due to low spending",
          "Annual fees outweigh potential rewards",
          "User already has optimal cards for spending patterns"
        ]
      }
    },
    {
      "name": "Card Portfolio Upgrade with Cancellation",
      "description": "User with suboptimal cards who should cancel and upgrade",
      "user_profile": {
        "spending": {
          "dining": 600,
          "travel": 400,
          "groceries": 300,
          "general": 500
        },
        "preferences": {
          "max_annual_fee": 400,
          "preferred_reward_type": "points"
        }
      },
      "owned_cards": ["Basic Travel Card", "Low Reward Card"],
      "available_cards": ["Basic Travel Card", "Low Reward Card", "Chase Sapphire Preferred® Card", "Gold Card", "SavorOne Cash Rewards Credit Card"],
      "expected_recommendations": {
        "actions": ["cancel", "apply"],
        "min_total_value": 200,
        "must_include_cards": ["Chase Sapphire Preferred® Card"],
        "cards_to_cancel": ["Basic Travel Card"],
        "reasoning_must_contain": ["cancel", "upgrade", "better rewards"],
        "test_conditions": [
          "Recommends canceling inferior cards",
          "Suggests better alternatives with higher rewards",
          "Net value improvement despite annual fees"
        ]
      }
    },
    {
      "name": "Portfolio Expansion - Add Complementary Cards",
      "description": "User with good cards who should add complementary cards for better coverage",
      "user_profile": {
        "spending": {
          "groceries": 800,
          "dining": 500,
          "travel": 300,
          "gas": 250,
          "general": 600
        },
        "preferences": {
          "max_annual_fee": 200,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Freedom Unlimited", "SavorOne Cash Rewards Credit Card"],
      "available_cards": ["Freedom Unlimited", "SavorOne Cash Rewards Credit Card", "Blue Cash Preferred® Card", "Costco Anywhere Visa® Card", "Gold Card"],
      "expected_recommendations": {
        "actions": ["keep", "apply"],
        "min_total_value": 300,
        "must_include_cards": ["Blue Cash Preferred® Card"],
        "cards_to_keep": ["Freedom Unlimited", "SavorOne Cash Rewards Credit Card"],
        "reasoning_must_contain": ["keep", "add", "groceries", "complement"],
        "test_conditions": [
          "Keeps existing good cards",
          "Adds cards for uncovered high-spend categories",
          "Maximizes rewards across all spending categories"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - Overlapping Reward Categories",
      "description": "Tests portfolio logic with multiple cards having overlapping reward categories - should only count highest rate",
      "user_profile": {
        "spending": {
          "groceries": 800,
          "dining": 600,
          "gas": 300,
          "general": 400
        },
        "preferences": {
          "max_annual_fee": 300,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Blue Cash Everyday", "SavorOne Cash Rewards Credit Card"],
      "available_cards": ["Blue Cash Everyday", "SavorOne Cash Rewards Credit Card", "Blue Cash Preferred® Card", "Custom Card A", "Custom Card B"],
      "expected_recommendations": {
        "actions": ["keep", "apply", "cancel"],
        "portfolio_optimization": {
          "total_annual_fees": 190,
          "category_optimization": {
            "groceries": {"best_rate": 6.0, "best_card": "Blue Cash Preferred® Card"},
            "dining": {"best_rate": 3.0, "best_card": "SavorOne Cash Rewards Credit Card"}
          },
          "no_duplicate_counting": true,
          "net_portfolio_value_positive": true
        },
        "reasoning_must_contain": ["portfolio", "optimization", "highest rate", "total fees"],
        "test_conditions": [
          "Only highest reward rate per category counts in portfolio calculation",
          "Total annual fees are sum of all recommended cards",
          "Net portfolio value = optimized rewards - total fees",
          "Portfolio summary shows category breakdown with best card for each"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - Redundant Cards Detection",
      "description": "Tests detection and recommendation to cancel redundant cards that provide no additional value",
      "user_profile": {
        "spending": {
          "groceries": 400,
          "dining": 300,
          "general": 500
        },
        "preferences": {
          "max_annual_fee": 200,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Grocery Card A", "Grocery Card B", "General Card"],
      "available_cards": ["Grocery Card A", "Grocery Card B", "General Card", "Better Grocery Card"],
      "expected_recommendations": {
        "actions": ["cancel", "keep", "apply"],
        "portfolio_optimization": {
          "redundant_cards_identified": ["Grocery Card B"],
          "optimal_portfolio_size": 2,
          "fee_reduction_achieved": true
        },
        "cards_to_cancel": ["Grocery Card B"],
        "reasoning_must_contain": ["redundant", "same category", "higher annual fee", "no additional value"],
        "test_conditions": [
          "Identifies cards that provide no additional portfolio value",
          "Recommends canceling inferior cards with same reward categories",
          "Keeps best card for each spending category",
          "Total portfolio fees are minimized while maintaining rewards"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - Annual Fee vs Rewards Analysis",
      "description": "Tests portfolio-level analysis of whether annual fees are justified by total portfolio rewards",
      "user_profile": {
        "spending": {
          "groceries": 200,
          "dining": 150,
          "travel": 100,
          "general": 250
        },
        "preferences": {
          "max_annual_fee": 500,
          "preferred_reward_type": "points"
        }
      },
      "owned_cards": ["Expensive Travel Card", "Expensive Dining Card"],
      "available_cards": ["Expensive Travel Card", "Expensive Dining Card", "No Fee Alternative", "Mid-Tier Card"],
      "expected_recommendations": {
        "actions": ["cancel", "apply"],
        "portfolio_optimization": {
          "total_annual_fees_before": 390,
          "total_annual_fees_after": 95,
          "net_portfolio_improvement": true,
          "fee_to_reward_ratio_improved": true
        },
        "reasoning_must_contain": ["low spending", "annual fees exceed", "portfolio optimization", "better value"],
        "test_conditions": [
          "Portfolio analysis considers total fees vs total optimized rewards",
          "Recommends fee reduction when spending doesn't justify premium cards",
          "Net portfolio value improvement is primary optimization goal",
          "Individual card value is secondary to portfolio optimization"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - Category Gap Analysis",
      "description": "Tests identification of spending categories not optimally covered by current portfolio",
      "user_profile": {
        "spending": {
          "groceries": 900,
          "dining": 400,
          "gas": 350,
          "travel": 600,
          "general": 300
        },
        "preferences": {
          "max_annual_fee": 400,
          "preferred_reward_type": "points"
        }
      },
      "owned_cards": ["Basic Card"],
      "available_cards": ["Basic Card", "Grocery Specialist", "Travel Premium", "Gas Rewards Card", "Dining Expert"],
      "expected_recommendations": {
        "actions": ["keep", "apply"],
        "portfolio_optimization": {
          "category_gaps_identified": ["groceries", "travel", "gas"],
          "optimal_portfolio_cards": 4,
          "category_coverage_improvement": true
        },
        "must_include_cards": ["Grocery Specialist", "Travel Premium"],
        "reasoning_must_contain": ["portfolio gaps", "category coverage", "maximize rewards", "complement existing"],
        "test_conditions": [
          "Identifies high-spend categories with suboptimal reward rates",
          "Recommends cards that fill portfolio gaps without redundancy",
          "Portfolio optimization maximizes total rewards across all categories",
          "Maintains cost-effectiveness of total portfolio"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - First Year Fee Waived Impact",
      "description": "Tests portfolio calculations with first-year fee waivers on new card applications",
      "user_profile": {
        "spending": {
          "dining": 600,
          "travel": 800,
          "groceries": 300,
          "general": 400
        },
        "preferences": {
          "max_annual_fee": 200,
          "preferred_reward_type": "points"
        }
      },
      "owned_cards": ["Mid-Tier Card"],
      "available_cards": ["Mid-Tier Card", "Premium Card with Waived Fee", "Regular Premium Card"],
      "expected_recommendations": {
        "actions": ["keep", "apply"],
        "portfolio_optimization": {
          "first_year_fee_waived": true,
          "effective_annual_fees_calculated": true,
          "waived_fee_advantage": true
        },
        "must_include_cards": ["Premium Card with Waived Fee"],
        "reasoning_must_contain": ["first year", "fee waived", "effective cost", "portfolio value"],
        "test_conditions": [
          "Portfolio summary accounts for waived first-year fees",
          "Effective annual fees are calculated correctly for new applications",
          "Fee waiver impact is clearly shown in portfolio optimization",
          "Cards with fee waivers get preference in cost-benefit analysis"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - Maximum Rewards with Spending Caps",
      "description": "Tests portfolio optimization when cards have annual spending limits on bonus categories",
      "user_profile": {
        "spending": {
          "groceries": 1500,
          "gas": 800,
          "dining": 400,
          "general": 600
        },
        "preferences": {
          "max_annual_fee": 300,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": [],
      "available_cards": ["Capped Grocery Card", "Unlimited Grocery Card", "Gas Specialist", "General Card"],
      "expected_recommendations": {
        "actions": ["apply"],
        "portfolio_optimization": {
          "spending_caps_considered": true,
          "cap_optimization": {
            "groceries": {"annual_cap": 6000, "spending_above_cap": 12000}
          },
          "multi_card_strategy": true
        },
        "reasoning_must_contain": ["spending cap", "annual limit", "maximize rewards", "portfolio strategy"],
        "test_conditions": [
          "Portfolio considers annual spending caps on bonus categories",
          "Recommends multiple cards when spending exceeds individual card caps",
          "Optimizes rewards across all spending levels (capped and uncapped)",
          "Portfolio strategy maximizes total rewards despite individual card limitations"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - Credit Benefits Integration",
      "description": "Tests portfolio optimization including card benefits/credits in total value calculation",
      "user_profile": {
        "spending": {
          "dining": 400,
          "travel": 300,
          "general": 500
        },
        "preferences": {
          "max_annual_fee": 400,
          "preferred_reward_type": "points"
        },
        "credit_preferences": ["travel_credit", "dining_credit", "streaming_credit"]
      },
      "owned_cards": [],
      "available_cards": ["Premium Card with Credits", "Basic Card", "Credits Specialist"],
      "expected_recommendations": {
        "actions": ["apply"],
        "portfolio_optimization": {
          "credit_benefits_included": true,
          "total_credits_value": 300,
          "net_value_with_credits": true
        },
        "must_include_cards": ["Premium Card with Credits"],
        "reasoning_must_contain": ["card benefits", "credits", "total value", "portfolio optimization"],
        "test_conditions": [
          "Portfolio calculation includes selected card benefits/credits",
          "Credit values are added to total portfolio rewards",
          "Net portfolio value accounts for both rewards and credits",
          "Benefits optimization is part of overall portfolio strategy"
        ]
      }
    },
    {
      "name": "Portfolio Optimization - Large Portfolio Rationalization",
      "description": "Tests optimization of user with too many cards - should recommend consolidation",
      "user_profile": {
        "spending": {
          "groceries": 500,
          "dining": 400,
          "gas": 200,
          "travel": 300,
          "general": 600
        },
        "preferences": {
          "max_annual_fee": 300,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Card A", "Card B", "Card C", "Card D", "Card E", "Card F"],
      "available_cards": ["Card A", "Card B", "Card C", "Card D", "Card E", "Card F", "Optimal Card X", "Optimal Card Y"],
      "expected_recommendations": {
        "actions": ["cancel", "keep", "apply"],
        "portfolio_optimization": {
          "portfolio_consolidation": true,
          "recommended_portfolio_size": 3,
          "total_fee_reduction": true,
          "simplified_strategy": true
        },
        "max_recommended_cards": 3,
        "reasoning_must_contain": ["too many cards", "consolidate", "simplify", "portfolio optimization", "redundant"],
        "test_conditions": [
          "Identifies portfolios with excessive number of cards",
          "Recommends consolidation to optimal number of cards",
          "Maintains or improves total rewards with fewer cards",
          "Reduces complexity while optimizing value"
        ]
      }
    },
    {
      "name": "Zero Fee Cards Protection - Never Cancel",
      "description": "Tests that $0 annual fee cards are never recommended for cancellation, even when redundant",
      "user_profile": {
        "spending": {
          "groceries": 300,
          "dining": 200,
          "general": 400
        },
        "preferences": {
          "max_annual_fee": 200,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card", "Expensive Premium Card"],
      "available_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card", "Expensive Premium Card", "Blue Cash Preferred® Card"],
      "expected_recommendations": {
        "actions": ["keep", "cancel", "apply"],
        "zero_fee_protection": {
          "zero_fee_cards_never_canceled": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card"],
          "only_fee_cards_canceled": ["Expensive Premium Card"],
          "zero_fee_cards_always_shown": true
        },
        "cards_to_keep": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card"],
        "cards_to_cancel": ["Expensive Premium Card"],
        "reasoning_must_contain": ["no annual fee", "$0 fee", "no cost to maintain"],
        "test_conditions": [
          "No $0 annual fee cards appear in cancel recommendations",
          "All $0 fee cards appear in keep recommendations",
          "Only fee-bearing cards are recommended for cancellation",
          "Zero fee cards show reasoning like 'Keep - no annual fee card'"
        ]
      }
    },
    {
      "name": "Zero Fee Cards Always Visible",
      "description": "Tests that $0 fee cards always appear in recommendations regardless of max_recommendations limit",
      "user_profile": {
        "spending": {
          "groceries": 200,
          "dining": 150,
          "general": 300
        },
        "preferences": {
          "max_annual_fee": 100,
          "preferred_reward_type": "cashback",
          "max_recommendations": 3
        }
      },
      "owned_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card", "Discover it Cash Back", "Citi Double Cash Card"],
      "available_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card", "Discover it Cash Back", "Citi Double Cash Card", "High Value Premium Card", "Mid Tier Card"],
      "expected_recommendations": {
        "actions": ["keep", "apply"],
        "smart_filtering": {
          "max_recommendations": 3,
          "zero_fee_cards_count": 5,
          "all_zero_fee_cards_shown": true,
          "priority_protection": true
        },
        "cards_to_keep": ["Freedom Unlimited", "Blue Cash Everyday", "Quicksilver Cash Rewards Credit Card", "Discover it Cash Back", "Citi Double Cash Card"],
        "reasoning_must_contain": ["no annual fee", "guaranteed inclusion"],
        "test_conditions": [
          "All $0 fee cards appear despite max_recommendations=3 limit",
          "Smart filtering reserves slots for $0 fee cards",
          "Total recommendations exceed max_recommendations when $0 fee cards present",
          "Zero fee cards have protected status in filtering logic"
        ]
      }
    },
    {
      "name": "Mixed Portfolio Zero Fee Protection",
      "description": "Tests portfolio optimization with mix of $0 fee and fee-bearing cards",
      "user_profile": {
        "spending": {
          "groceries": 600,
          "dining": 400,
          "travel": 300,
          "gas": 250,
          "general": 500
        },
        "preferences": {
          "max_annual_fee": 300,
          "preferred_reward_type": "points"
        }
      },
      "owned_cards": ["Freedom Unlimited", "Chase Sapphire Reserve®", "Chase Sapphire Reserve Business", "Blue Cash Everyday", "Expensive Dining Card"],
      "available_cards": ["Freedom Unlimited", "Chase Sapphire Reserve®", "Chase Sapphire Reserve Business", "Blue Cash Everyday", "Expensive Dining Card", "Blue Cash Preferred® Card", "Gold Card"],
      "expected_recommendations": {
        "actions": ["keep", "cancel", "apply"],
        "portfolio_optimization": {
          "zero_fee_cards_protected": ["Freedom Unlimited", "Blue Cash Everyday"],
          "redundant_fee_cards_canceled": ["Chase Sapphire Reserve Business"],
          "optimal_mix_achieved": true
        },
        "cards_to_keep": ["Freedom Unlimited", "Blue Cash Everyday", "Chase Sapphire Reserve®"],
        "cards_to_cancel": ["Chase Sapphire Reserve Business", "Expensive Dining Card"],
        "reasoning_must_contain": ["no annual fee", "redundant card", "portfolio optimization"],
        "test_conditions": [
          "Zero fee cards are always kept regardless of portfolio overlap",
          "Only fee-bearing redundant cards are recommended for cancellation",
          "Portfolio optimization considers $0 fee cards as 'free value'",
          "Mixed portfolio maintains cost-effectiveness while protecting no-fee cards"
        ]
      }
    },
    {
      "name": "Low Value Zero Fee Cards Still Protected",
      "description": "Tests that even low-reward $0 fee cards are never canceled",
      "user_profile": {
        "spending": {
          "groceries": 800,
          "dining": 600,
          "general": 400
        },
        "preferences": {
          "max_annual_fee": 200,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Low Reward Zero Fee Card", "Freedom Unlimited", "Premium Grocery Card"],
      "available_cards": ["Low Reward Zero Fee Card", "Freedom Unlimited", "Premium Grocery Card", "Blue Cash Preferred® Card", "SavorOne Cash Rewards Credit Card"],
      "expected_recommendations": {
        "actions": ["keep", "apply"],
        "zero_fee_protection": {
          "low_value_zero_fee_protected": ["Low Reward Zero Fee Card"],
          "no_cancellation_regardless_of_value": true,
          "free_value_principle": true
        },
        "cards_to_keep": ["Low Reward Zero Fee Card", "Freedom Unlimited"],
        "reasoning_must_contain": ["no annual fee", "no cost to maintain", "free value"],
        "test_conditions": [
          "Low-reward $0 fee cards are never recommended for cancellation",
          "Portfolio logic treats $0 fee cards as 'free value' regardless of rewards",
          "No minimum reward threshold for keeping $0 fee cards",
          "Even 1% cashback $0 fee cards are protected from cancellation"
        ]
      }
    },
    {
      "name": "Zero Fee Cards in Sectioned Display",
      "description": "Tests that $0 fee cards appear properly in the 'Keep These Cards' section",
      "user_profile": {
        "spending": {
          "groceries": 400,
          "dining": 300,
          "general": 300
        },
        "preferences": {
          "max_annual_fee": 150,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Expensive Premium Card", "Mid-Fee Card"],
      "available_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Expensive Premium Card", "Mid-Fee Card", "SavorOne Cash Rewards Credit Card"],
      "expected_recommendations": {
        "actions": ["keep", "cancel", "apply"],
        "sectioned_display": {
          "keep_section": ["Freedom Unlimited", "Blue Cash Everyday"],
          "cancel_section": ["Expensive Premium Card", "Mid-Fee Card"],
          "apply_section": ["SavorOne Cash Rewards Credit Card"],
          "proper_organization": true
        },
        "reasoning_must_contain": ["Keep These Cards", "Consider Canceling", "Apply for These Cards"],
        "test_conditions": [
          "Zero fee cards appear in 'Keep These Cards' section",
          "Only fee-bearing cards appear in 'Consider Canceling' section",
          "Sectioned display properly organizes recommendations by action type",
          "No $0 fee cards leak into cancellation section"
        ]
      }
    },
    {
      "name": "Overlapping Zero Fee Cards Portfolio",
      "description": "Tests portfolio optimization when multiple $0 fee cards have overlapping categories",
      "user_profile": {
        "spending": {
          "groceries": 300,
          "dining": 200,
          "general": 500
        },
        "preferences": {
          "max_annual_fee": 100,
          "preferred_reward_type": "cashback"
        }
      },
      "owned_cards": ["Freedom Unlimited", "Quicksilver Cash Rewards Credit Card", "Citi Double Cash Card", "Blue Cash Everyday"],
      "available_cards": ["Freedom Unlimited", "Quicksilver Cash Rewards Credit Card", "Citi Double Cash Card", "Blue Cash Everyday", "Blue Cash Preferred® Card"],
      "expected_recommendations": {
        "actions": ["keep", "apply"],
        "portfolio_optimization": {
          "overlapping_zero_fee_all_kept": true,
          "highest_rate_calculation": true,
          "no_zero_fee_consolidation": true,
          "portfolio_value_optimized": true
        },
        "cards_to_keep": ["Freedom Unlimited", "Quicksilver Cash Rewards Credit Card", "Citi Double Cash Card", "Blue Cash Everyday"],
        "reasoning_must_contain": ["no annual fee", "no cost to maintain", "portfolio optimization"],
        "test_conditions": [
          "All $0 fee cards are kept even with overlapping reward categories",
          "Portfolio optimization uses highest rate among $0 fee cards for calculations",
          "No recommendation to consolidate overlapping $0 fee cards",
          "Portfolio value calculation properly handles multiple $0 fee cards"
        ]
      }
    },
    {
      "name": "Zero Fee Card Smart Filtering Priority",
      "description": "Tests that smart filtering logic properly prioritizes $0 fee cards over other recommendations",
      "user_profile": {
        "spending": {
          "groceries": 200,
          "dining": 150,
          "general": 250
        },
        "preferences": {
          "max_annual_fee": 200,
          "preferred_reward_type": "cashback",
          "max_recommendations": 2
        }
      },
      "owned_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Premium Card A", "Premium Card B"],
      "available_cards": ["Freedom Unlimited", "Blue Cash Everyday", "Premium Card A", "Premium Card B", "High Value Premium Card", "Best Apply Card"],
      "expected_recommendations": {
        "actions": ["keep", "cancel", "apply"],
        "smart_filtering": {
          "zero_fee_priority": true,
          "reserved_slots": 2,
          "max_recommendations_exceeded": true,
          "filtering_logic": "zero_fee_cards + top_other_recommendations + all_cancels"
        },
        "cards_to_keep": ["Freedom Unlimited", "Blue Cash Everyday"],
        "cards_to_cancel": ["Premium Card A", "Premium Card B"],
        "reasoning_must_contain": ["smart filtering", "reserved slots", "priority protection"],
        "test_conditions": [
          "Zero fee cards get reserved slots in smart filtering",
          "Total recommendations exceed max_recommendations due to zero fee protection",
          "Smart filtering = top_other_keeps_applies + all_zero_fee + all_cancels",
          "Zero fee cards cannot be filtered out by recommendation limits"
        ]
      }
    },
    {
      "name": "Spending Credits - Basic Credit Type Matching",
      "description": "Tests that spending credit preferences are properly matched with card credits using spending_credit field",
      "user_profile": {
        "spending": {
          "dining": 400,
          "travel": 300,
          "general": 500
        },
        "spending_credit_preferences": ["uber_eats", "dashpass", "precheck"]
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Reserve", "Blue Cash Preferred Card from American Express", "Venture Rewards"],
      "expected_recommendations": {
        "actions": ["apply"],
        "spending_credits_integration": {
          "credit_benefits_included": true,
          "selected_credits_only": ["uber_eats", "dashpass", "precheck"],
          "annual_value_calculation": true
        },
        "reasoning_must_contain": ["credit", "benefits", "dining"],
        "test_conditions": [
          "Only selected spending credits contribute to card value",
          "Cards with matching spending credits get higher estimated value",
          "Credit values are included in total portfolio rewards",
          "Spending credit preferences filter card benefits properly"
        ]
      }
    },
    {
      "name": "Spending Credits - Times Per Year Calculation",
      "description": "Tests proper calculation of credit values with times_per_year multiplier",
      "user_profile": {
        "spending": {
          "dining": 600,
          "travel": 800,
          "general": 400
        },
        "spending_credit_preferences": ["dashpass", "apple_tv", "doordash"]
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Reserve", "Chase Sapphire Reserve Business"],
      "expected_recommendations": {
        "actions": ["apply"],
        "spending_credits_integration": {
          "times_per_year_handled": true,
          "annual_calculations": {
            "dashpass": {"monthly_value": 10, "times_per_year": 12, "annual_value": 120},
            "apple_tv": {"monthly_value": 10, "times_per_year": 12, "annual_value": 120},
            "doordash": {"monthly_value": 25, "times_per_year": 12, "annual_value": 300}
          },
          "total_credits_expected": 540
        },
        "reasoning_must_contain": ["credit", "annual value", "benefits"],
        "test_conditions": [
          "Credit values are multiplied by times_per_year correctly",
          "Monthly credits (times_per_year=12) are calculated properly",
          "Annual credits (times_per_year=1) default correctly",
          "Total credit value reflects proper multiplication"
        ]
      }
    },
    {
      "name": "Spending Credits - Category-Based Credits",
      "description": "Tests category-based credits that are automatically included when user spends in that category",
      "user_profile": {
        "spending": {
          "dining": 500,
          "travel": 600,
          "hotels": 300,
          "general": 400
        },
        "spending_credit_preferences": []
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Reserve", "Sapphire Preferred"],
      "expected_recommendations": {
        "actions": ["apply"],
        "spending_credits_integration": {
          "category_credits_included": true,
          "automatic_inclusion": true,
          "category_based_credits": ["travel", "dining", "hotels"]
        },
        "reasoning_must_contain": ["travel credit", "dining"],
        "test_conditions": [
          "Category-based credits are included when user spends in that category",
          "No explicit credit preference selection needed for category credits",
          "Travel credits included for travel spending",
          "Dining credits included for dining spending",
          "Hotel credits included for hotel spending"
        ]
      }
    },
    {
      "name": "Spending Credits - Mixed Credit Types",
      "description": "Tests portfolio with both spending_credit and category-based credits",
      "user_profile": {
        "spending": {
          "dining": 400,
          "travel": 500,
          "streaming": 50,
          "general": 600
        },
        "spending_credit_preferences": ["disney_plus", "apple_tv", "uber_eats"]
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Reserve", "Blue Cash Preferred Card from American Express"],
      "expected_recommendations": {
        "actions": ["apply"],
        "spending_credits_integration": {
          "mixed_credit_types": true,
          "spending_credits": ["disney_plus", "apple_tv", "uber_eats"],
          "category_credits": ["travel", "dining"],
          "total_credit_value_positive": true
        },
        "reasoning_must_contain": ["credits", "benefits", "streaming", "travel"],
        "test_conditions": [
          "Both spending_credit and category-based credits are calculated",
          "Spending credit preferences apply to spending_credit fields",
          "Category spending automatically includes category-based credits",
          "No double counting between different credit types",
          "Total portfolio value includes all applicable credits"
        ]
      }
    },
    {
      "name": "Spending Credits - No Double Counting",
      "description": "Tests that credits are not double-counted in portfolio optimization",
      "user_profile": {
        "spending": {
          "dining": 600,
          "travel": 400,
          "general": 500
        },
        "spending_credit_preferences": ["dashpass", "uber_eats"]
      },
      "owned_cards": ["Chase Sapphire Reserve", "Chase Sapphire Reserve Business"],
      "available_cards": ["Chase Sapphire Reserve", "Chase Sapphire Reserve Business", "Blue Cash Preferred Card from American Express"],
      "expected_recommendations": {
        "actions": ["keep", "cancel", "apply"],
        "spending_credits_integration": {
          "no_double_counting": true,
          "unique_credits_only": true,
          "portfolio_deduplication": true
        },
        "reasoning_must_contain": ["portfolio optimization", "redundant"],
        "test_conditions": [
          "Same credit type across multiple cards is counted only once",
          "Portfolio optimization prevents credit double counting",
          "Unique credits are identified by credit slug/type",
          "Total portfolio credit value reflects deduplicated credits only"
        ]
      }
    },
    {
      "name": "Spending Credits - High Value Credit Cards",
      "description": "Tests recommendation of cards with high-value credits matching user preferences",
      "user_profile": {
        "spending": {
          "dining": 300,
          "travel": 200,
          "business": 400,
          "general": 300
        },
        "spending_credit_preferences": ["google_workspace", "ziprecruiter", "lyft"]
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Reserve Business", "The Platinum Card from American Express", "Ink Business Preferred Credit Card"],
      "expected_recommendations": {
        "actions": ["apply"],
        "spending_credits_integration": {
          "high_value_credits": true,
          "business_credits_included": ["google_workspace", "ziprecruiter"],
          "transportation_credits": ["lyft"],
          "credit_value_justifies_fees": true
        },
        "must_include_cards": ["Chase Sapphire Reserve Business"],
        "reasoning_must_contain": ["business credits", "workspace", "high value"],
        "test_conditions": [
          "High-value credits like Google Workspace ($240/year) are properly calculated",
          "Business-focused spending credits are matched correctly",
          "Transportation credits like Lyft are included when selected",
          "Total credit value makes annual fees worthwhile",
          "Cards with matching business credits are prioritized"
        ]
      }
    },
    {
      "name": "Spending Credits - Zero Credit Preferences",
      "description": "Tests behavior when user selects no spending credit preferences",
      "user_profile": {
        "spending": {
          "dining": 400,
          "travel": 300,
          "general": 500
        },
        "spending_credit_preferences": []
      },
      "owned_cards": [],
      "available_cards": ["Chase Sapphire Reserve", "Blue Cash Preferred Card from American Express", "Wells Fargo Active Cash® Card"],
      "expected_recommendations": {
        "actions": ["apply"],
        "spending_credits_integration": {
          "no_spending_credits_selected": true,
          "category_credits_still_included": true,
          "focus_on_rewards_not_credits": true
        },
        "reasoning_must_contain": ["rewards", "cashback"],
        "test_conditions": [
          "No spending_credit based benefits are included in calculations",
          "Category-based credits are still included when spending in those categories",
          "Card recommendations focus on reward rates rather than credits",
          "Portfolio optimization works without credit preferences",
          "Basic card benefits may still be recommended"
        ]
      }
    },
    {
      "name": "Spending Credits - Credit Value vs Annual Fee Analysis",
      "description": "Tests that credit values are properly weighed against annual fees in recommendations",
      "user_profile": {
        "spending": {
          "dining": 200,
          "travel": 150,
          "streaming": 25,
          "general": 300
        },
        "spending_credit_preferences": ["disney_plus", "apple_tv"]
      },
      "owned_cards": [],
      "available_cards": ["Blue Cash Preferred Card from American Express", "Wells Fargo Active Cash® Card", "Chase Sapphire Reserve"],
      "expected_recommendations": {
        "actions": ["apply"],
        "spending_credits_integration": {
          "credit_value_analysis": true,
          "low_value_credits": {"disney_plus": 84, "apple_tv": 120},
          "fee_vs_credit_comparison": true
        },
        "reasoning_must_contain": ["annual fee", "credit value", "cost-effective"],
        "test_conditions": [
          "Low-value credits don't justify high annual fees",
          "Credit values are accurately calculated (times_per_year)",
          "Portfolio optimization considers credit ROI",
          "Lower fee cards preferred when credit values are minimal",
          "Net value calculation includes both rewards and credits vs fees"
        ]
      }
    }
  ]
}