{% extends 'base.html' %}

{% block title %}Spending Categories - Credit Card Guru{% endblock %}

{% block content %}
<h1>ðŸ“Š Spending Categories</h1>
<p style="text-align: center; color: #6b7280; margin-bottom: 40px;">
    View all spending categories tracked by the system
</p>

<div id="categoriesContainer">
    <div class="loading">ðŸ”„ Loading spending categories...</div>
</div>

<script>
async function loadCategories() {
    try {
        const response = await fetch(`${API_BASE}/cards/spending-categories/`);
        const data = await response.json();
        const categories = data.results || data;
        
        displayCategories(categories);
        
    } catch (error) {
        console.error('Error loading categories:', error);
        document.getElementById('categoriesContainer').innerHTML = 
            '<div class="error">Error loading categories. Please try again.</div>';
    }
}

function displayCategories(categories) {
    const container = document.getElementById('categoriesContainer');
    
    if (categories.length === 0) {
        container.innerHTML = '<div class="error">No categories found.</div>';
        return;
    }
    
    // Sort categories by sort_order
    categories.sort((a, b) => (a.sort_order || 100) - (b.sort_order || 100));
    
    const html = categories.map(category => `
        <div class="card-item">
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                ${category.icon ? `<i class="${category.icon}" style="font-size: 24px; margin-right: 15px; color: #2563eb;"></i>` : ''}
                <div>
                    <div class="card-title">${category.display_name || category.name}</div>
                    <div style="color: #6b7280; font-size: 12px; font-weight: normal;">Sort: ${category.sort_order || 100}</div>
                </div>
            </div>
            <div class="card-details">
                <p><strong>Description:</strong> ${category.description || `Track spending on ${category.name.toLowerCase()}`}</p>
                <p><strong>Category Slug:</strong> ${category.slug}</p>
            </div>
        </div>
    `).join('');
    
    container.innerHTML = html;
}

// Load categories when page loads
loadCategories();
</script>
{% endblock %}